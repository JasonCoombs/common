/*

***********************************************************************************
* Copyright (C) 2020 - 2021, BlockSettle AB
* Distributed under the GNU Affero General Public License (AGPL v3)
* See LICENSE or http://www.gnu.org/licenses/agpl.html
*
**********************************************************************************

*/
syntax = "proto3";

package Blocksettle.Server;

import "bs_api_server.proto";
import "bs_types.proto";
import "common.proto";
import "pb_cli.proto";
import "trade_history.proto";
import "genoa_admin.proto";

message Empty
{
}

enum PrivBridgeType
{
   PrivBridgeUnknownType         = 0;
   PrivBridgeSuspendTrading      = 3;
   PrivBridgeResumeTrading       = 4;
   PrivateBridgeGetHashedEmail   = 7;
}

message PrivBridgeResponse
{
   int32  result_code = 1;
   string error_text = 2;
}

message GetHashedEmailRequest
{
   repeated string customer_email = 1;
}

message GetHashedEmailResponse
{
   message EmailHash
   {
      string customer_email   = 1;
      string email_hash       = 2;
   }

   repeated EmailHash email_hash = 1;
}

message PrivateBridgeMessage
{
   PrivBridgeType type = 1;
   oneof data {
      string                        message                    = 3;
      PrivBridgeResponse            response                   = 4;
      GetHashedEmailRequest         get_hashed_email_request   = 5;
      GetHashedEmailResponse        get_hashed_email_response  = 6;
   }
}


message WalletMessage
{
   message AuthWalletLoaded
   {
      string wallet_id = 1;   // not set atm
      repeated string addresses = 2;
   }

   message Addresses
   {
      string wallet_id = 1;
      repeated string addresses = 2;
   }

   message DepositAddressTX
   {
      string                  address  = 1;
      bs.types.XBTAmountValue amount   = 2;
      bytes                   tx_hash  = 3;
      uint32                  nb_conf  = 4;
   }

   message OutInstaTxRequest
   {
      string                  out_address = 1;
      bs.types.XBTAmountValue amount      = 2;
   }

   message OutInstaTxResponse
   {
      string out_address = 1;
      bytes  signed_tx = 2;
   }

   message ReturnRejectedDepositRequest
   {
      string   deposit_address   = 1;
      bytes    deposit_tx_id     = 2;
      string   return_address    = 3;
   }

   message ReturnRejectedDepositResponse
   {
      bytes signed_tx = 1;
   }

   oneof data {
      Empty                                  wallet_reload           = 1;
      string                                 wallet_loaded           = 2; // wallet id
      AuthWalletLoaded                       auth_wallet_loaded      = 3;
      Blocksettle.Communication.pbcli.LoadUTXOResponse utxos         = 4;
      bool                                   get_all_utxo            = 5;
      bytes                                  bootstrap_data          = 6;
      uint32                                 get_new_trading_addrs   = 7;
      Addresses                              trading_addresses       = 8;
      uint32                                 get_new_deposit_addrs   = 9;
      Addresses                              deposit_addresses       = 10;
      DepositAddressTX                       deposit_address_tx      = 11;
      OutInstaTxRequest                      out_insta_tx_request    = 12;
      OutInstaTxResponse                     out_insta_tx_response   = 13;
      ReturnRejectedDepositRequest           return_deposit_request  = 14;
      ReturnRejectedDepositResponse          return_deposit_response = 15;
      Empty                                  get_hot_wallet_balance  = 16;
      BlockSettle.Common.ArmoryMessage.WalletBalanceResponse hot_wallet_balance = 17;
   }
}


message CCDefinitionsData
{
   repeated string cc = 1;
}

message CCTxValidRequest
{
   string request_id = 1;
   string cc = 2;
   bytes  tx = 3;
   string cc_recv_address = 4;
   string xbt_recv_address = 5;
   uint32 qty = 6;
   uint64 xbt_recv_amount = 7;
}

message CCTxValidResponse
{
   string request_id = 1;
   bool   is_valid = 2;
   string debug_string = 3;
   bytes  tx_hash = 4;
}

message CCValidateHalvesRequest
{
   string settlement_id = 1;
   bytes  requester_tx = 2;
   bytes  dealer_tx = 3;
   string cc = 4;
   string requester_receipt_addr = 5;
   string dealer_receipt_addr = 6;
   double quantity = 7;
   double price = 8;
   bool   requester_buys = 9;
   bytes  tx_hash = 10;
}

message CCValidateHalvesResponse
{
   string settlement_id = 1;
   bool   success = 2;
   repeated OutPointData outpoints = 3;
   ReturnData return = 4;

   message ReturnData {
      int32  index = 1;
      string address = 2;
      uint32 amount = 3;
   }
}

message CCValidateHalfRequest
{
   enum TxType {
      Unknown = 0;
      Requester = 1;
      Dealer = 2;
      Merged = 3;
   }
   string request_id = 1;
   string cc = 2;
   uint32 qty = 3;
   bool   req_sells = 4;
   double price = 5;
   bytes  coin_input = 6;
   TxType tx_type = 7;
}

message CCValidateHalfResponse
{
   enum Result {
      AllOk = 0;
      ValueMismatch = 1;
      InvalidInput  = 2;
      InvalidCCData = 3;
      OutputsDisorder = 4;
      InvalidOutput = 5;
   }
   string request_id = 1;
   Result result = 2;
   repeated bytes cc_inputs = 3;
}

message CCUpdatedGenesisAddress
{
   string cc_name    = 1;
   string ga_address = 2;
}

message LoadedCCDefinition
{
   string cc_name       = 1;
   string ga_address    = 2;
   int32  lot_size      = 3;
}

enum CcTrackMessageType
{
   CcTrackUnknownType         = 0;
   CcTrackCCDefinitions       = 1;
   CcTrackIsTxValid           = 2;
   CcTrackValidateHalves      = 3;
   CcTrackNewDefinitions      = 4;
   CcTrackDisabledDefinition  = 5;
   CcUpdatedGenesisAddress    = 6;
   CCDefinitionLoaded         = 7;
   CcTrackValidateUnsignedHalf= 8;
}

message CcTrackMessage
{
   CcTrackMessageType type = 1;
   oneof data {
      CCDefinitionsData          cc_definitions          = 2;
      CCTxValidRequest           tx_valid_request        = 3;
      CCTxValidResponse          tx_valid_response       = 4;
      CCValidateHalvesRequest    cc_valid_request        = 5;
      CCValidateHalvesResponse   cc_valid_response       = 6;
      CCUpdatedGenesisAddress    updated_genesis_address = 7;
      LoadedCCDefinition         loaded_cc_definition    = 8;
      CCValidateHalfRequest      cc_unsigned_half_req    = 9;
      CCValidateHalfResponse     cc_unsigned_half_resp   = 10;
   }
}


enum GenoaType
{
   GenoaUnknownType                       = 0;
   GenoaReconnect                         = 1;
   GenoaHeartbeat                         = 2;
   GenoaAccounts                          = 3;
   GenoaNewAccount                        = 4;
   GenoaGetXBTReservations                = 5;
   GenoaGetCCReservations                 = 6;
   GenoaCancelCCReservation               = 7;
   GenoaCancelXBTReservation              = 8;
   GenoaReserveCashXBT                    = 9;
   GenoaUpdateReservation                 = 10;
   GenoaCompleteXbtCashTransfer           = 11;
   GenoaUpdateBalanceType                 = 12;
   GenoaExecuteFxTrade                    = 13;
   GenoaFindOrdersForUser                 = 14;
   GenoaUserTradingStatus                 = 15;
   GenoaTradeXbtUpdate                    = 16;
   GenoaSendCCToken                       = 17;
   GenoaReserveCC                         = 18;
   GenoaCompleteCCReserve                 = 19;
   GenoaGetUserAccounts                   = 20;
   GenoaReloadCustomerBalance             = 21;
   GenoaEODUpdate                         = 22;
   GenoaMigrateUserIds                    = 23;
   GenoaApiKey                            = 24;
   GetEntityId                            = 25;
   GetUserEmail                           = 26;
   GenoaListApiKeysType                   = 29;
   GenoaCreateExternalAccountType         = 31;
   GenoaGetCustomerBalance                = 35;
   GenoaLoadDeliveryObligations           = 36;
   GenoaSetDeliveryAddress                = 37;
   GenoaSettleDelivery                    = 38;
   GenoaReloadAccounts                    = 39;
   GenoaAccountReloaded                   = 40;
   GenoaCreateIbanAgreementUrlType        = 41;
   GenoaGetIbanAccountsType               = 42;
   GenoaGetIbanAccountDetailsType         = 43;
   GenoaUserNotify                        = 44;
   GenoaRegisterXBTDepositType            = 45;
   GenoaConfirmXBTDepositType             = 46;
   GenoaRegisterXBTWithdrawType           = 47;
   GenoaConfirmXBTWithdrawType            = 48;
   GenoaReportRejectedDeposit             = 49;
   GenoaTradeHistory                      = 50;
   GenoaTransactionsForEntity             = 51;
   GenoaGetStatementDates                 = 52;
   GenoaGetStatements                     = 53;
   GenoaPoolMargins                       = 54;
   GenoaProfitLossPayout                  = 55;
   GenoaFutureCreateReservations          = 56;
   GenoaCreateNovationAccount             = 57;
   GenoaDisposeNovationAccount            = 58;
   GenoaRegisterFcm                       = 70;
   GenoaUnregisterFcm                     = 71;
   GenoaSendFcm                           = 72;
   NovationAccountInfo                    = 73;
}

message GenoaDisconnectedBroadcast
{
   int32 error = 1;
}

message GenoaXBTReservation
{
   int32  subsystem = 1;
   string requester_trd_account = 2;
   uint32 requester_entity_id = 3;
   string dealer_trd_account = 4;
   uint32 dealer_entity_id = 5;
   string settlement_id = 6;
   string cl_ord_id = 7;
   double xbt_amount = 8;
   double ccy_amount = 9;
   string currency = 10;
   bool   requester_sells = 11;
   string requester_pub_key = 12;
   string dealer_pub_key = 13;
   bytes  unsigned_payin = 14;
   bytes  signed_payin = 15;
   bytes  signed_payout = 16;
   uint64 created_timestamp = 17;
   string last_status = 18;
}

message GenoaCCReservation
{
   string trade_id = 1;
   uint32 requester_entity_id = 2;
   uint32 dealer_entity_id = 3;
   string product = 4;
   double amount = 5;
   double price = 6;
   bool   requester_buys = 7;
   bytes  requester_tx_data = 8;
   string requester_recv_address = 9;
   bytes  dealer_tx_data = 10;
   string dealer_recv_address = 11;
   uint64 created_timestamp = 12;
}

message GenoaXBTReservationsResponse
{
   bool   success = 1;
   string error_text = 2;
   repeated GenoaXBTReservation reservations = 3;
}

message GenoaCCReservationResponse
{
   bool   success = 1;
   string error_text = 2;
   repeated GenoaCCReservation reservations = 3;
}

message GenoaCancelCCReservationRequest
{
   string reservation_id = 1;
}

message GenoaCancelCCReservationResponse
{
   bool   success = 1;
   string error_text = 2;
}

message GenoaUserRequest
{
   uint32 entity_id = 1;
}

message GenoaOrderData
{
   string id               = 11;
   int32  subsystem        = 1;
   double price            = 2;
   string contra_product   = 3;
   double quantity         = 4;
   double contra_quantity  = 5;
   string product          = 6;
   int32  trade_status     = 7;
   uint64 timestamp        = 8;
   string status           = 9;
   int32  trade_type       = 10;
   double cut_off_price    = 12;
   double trade_im         = 13;
   bool   is_rollover      = 14;
}

message GenoaFindOrdersResponse
{
   bool   loaded = 1;
   string error_text = 2;
   uint32 entity_id = 3;
   repeated GenoaOrderData orders = 4;
}

message GenoaTradingStatusResponse
{
   bool   success       = 1;
   string error_text    = 2;
   int32  user_type     = 3;
}

message GenoaReserveXbtResponse
{
   string settlement_id = 1;
   bool   success       = 2;
   string error_message = 3;
   string currency      = 4;
   double new_balance   = 5;

   CustomerAccountData changed_account = 6;
}

message GeanoReserveCCResponse
{
   bool     success        = 1;
   string   error_message  = 2;
}

message GenoaUpdateReserveRequest
{
   string reserve_id = 1;
   repeated KeyValue values = 2;

   message KeyValue {
      string key = 1;
      string value = 2;
   }
}

message GenoaXbtCompleteTransferResponse
{
   bool   settled = 1;
   bool   complete = 2;
   string error_text = 3;
   CustomerAccountData changed_account = 4;
   string currency = 5;
   bs.types.FXAmountValue new_balance = 6;
}

message GenoaFxTradeResponse
{
   int64  sequence_num = 1;
   string cl_ord_id = 2;
   string currency_pair = 3;
   bool   matched = 4;
   string error_text = 5;
   repeated AccountBalances account_balances = 6;

   message AccountBalances
   {
      uint32 entity_id = 1;
      repeated BalanceData balances = 2;
   }
}

message GenoaTradeXbtUpdateRequest
{
   string settlement_id = 1;
   string status = 2;
}

message GenoaSendCCTokenRequest
{
   string user_id    = 1;
   string cc_token   = 2;
   string cc_name    = 3;
   uint32 amount     = 4;
}

message GenoaAccountUserRequest
{
   uint32 entity_id = 1;
   string email = 3;
}

message GenoaAccountsData
{
   repeated CustomerAccountData data = 1;
   repeated CurrencyMap currency_map = 2;
   string error_text = 3;

   message CurrencyMap {
      string currency = 1;
      int64  currency_id = 2;
   }
}

message GenoaAccountsBalanceUpdate
{
   uint32 entity_id = 1;
   string currency = 2;
   bs.types.FXAmountValue balance = 3;
}

enum GenoaAccountRequestType
{
   GenoaAccountUnknown           = 0;
   GenoaAccountUser              = 1;
   GenoaAccountUsers             = 2;
   GenoaAccountBalancesSnapshot  = 3;
}

message GenoaAccountMessage
{
   message Balances
   {
      message Account
      {
         string   accountName = 1;
         int64    accountId = 2;
         string   entityName = 3;
         int64    entityId = 4;
         string   currency = 5;
         int64    currencyId = 6;
         double   balance = 7;
      }
      repeated Account accounts = 1;
   }

   GenoaAccountRequestType type = 1;
   oneof data {
      GenoaAccountUserRequest    user_request      = 2;
      CustomerAccountData        account_data      = 3;
      GenoaAccountsData          accounts          = 4;
      Balances                   balance_snapshot  = 5;
      GenoaAccountsBalanceUpdate balance_update    = 6;
   }
}

message GenoaAccountData
{
   string   email          = 1;
   string   entity_name    = 2;
   uint32   entity_id      = 3;
   string   account_name   = 4;
   string   account_type   = 5;
   uint32   account_id     = 6;
   string   email_hashed   = 7;
}

message GenoaAccountInfoResponse
{
   string email = 1;
   repeated GenoaAccountData accounts = 2;
   string error_text = 3;
}

message GenoaAccountBalanceRequest
{
   uint32 entity_id = 1;
   repeated string currency = 2;
}

message GenoaAccountBalanceResponse
{
   uint32 entity_id = 1;
   repeated BalanceData balances = 2;
   string error_text = 3;
}

message GenoaEODUpdateMessage
{
   message GenoaPrice
   {
      string product = 1;
      bs.types.XBTPrice price = 2;
   }

   string               date     = 1;
   repeated GenoaPrice  prices   = 2;
}

message GenoaApiKeyCheckRequest
{
   string api_key = 1;
   string ip_addr = 2;
}

message GenoaApiKeyCheckResponse
{
   string api_key             = 1;
   uint32 entity_id           = 2;
   bs.types.ApiKeyError error = 3;
}

message UserEntityInfo
{
   string user_email    = 1;
   string entity_name   = 2;
   uint32 entity_id     = 3;
}

message AffectedEntities
{
   repeated uint32 entity_id = 1;
}

message SetDeliveryAddress
{
   string trade_id            = 1;
   string bs_delivery_address = 2;
}

message SetDeliveryAddressResponse
{
   string   trade_id = 1;
   bool     result   = 2;
}

message SettleDelivery
{
   string trade_id = 1;
}


message LoadedGenoaObligationData
{
   uint32 entity_id           = 1;
   string product             = 2;
   string trade_id            = 3;
   string bs_delivery_address = 4;
   double price               = 5;
   double xbt_amount          = 6;
}

message LoadAllObligationsResponse
{
   bool                                loaded      = 1;
   repeated LoadedGenoaObligationData  obligation  = 2;
}

message GenoaUserNotifyMsg
{
   uint32            broadcast_to         = 1; // entity_id
   string            message              = 2;
   string            code                 = 3;
   string            type                 = 4;
}

message GenoaCreateIbanAgreementUrlRequest
{
   uint32   entity_id            = 1;
   string   country_short_code   = 2;
   string   iban                 = 3;
   string   redirect             = 4;
   bool     sandbox              = 5;
}

message GenoaCreateIbanAgreementUrlResponse
{
   bool error = 1;
   string message = 2;
   string ref = 3;
   string initiate = 4;
}

message GenoaGetIbanAccountsRequest
{
   string requisitions_id = 1;
   uint32 entity_id       = 2;
}

message GenoaGetIbanAccountsResponse
{
   bool loaded = 1;
   repeated string results = 2;
}

message GenoaGetIbanAccountDetailsRequest
{
   string account_ref = 1;
}

message GenoaGetIbanAccountDetailsResponse
{
   bool     loaded            = 1;
   string   resource_id       = 2;
   string   iban              = 3;
   string   currency          = 4;
   string   name              = 5;
   string   product           = 6;
   string   cash_account_type = 7;
   string   account_ref       = 8;
}

message GenoaListApiKeysRequest
{
   uint32 entity_id = 1;
}

message ApiKey
{
   int32 id = 1;
   string token = 2;
   string allow = 3;
   string label = 4;
   string created = 5;
}

message GenoaListApiKeysResponse
{
   bool loaded = 1;
   repeated ApiKey keys = 2;
}

message GenoaCreateExternalAccountRequest
{
   uint32 entity_id = 1;
   string account_ref = 2;
}

message GenoaCreateExternalAccountResponse
{
   message ExternalAccountInfo
   {
      string   name        = 1;
      string   created_at  = 2;
      string   bank_name   = 3;
   }

   bool                 created  = 1;
   ExternalAccountInfo  account  = 2;
}

message GenoaRegisterXBTDepositRequest
{
   uint32                  entity_id      = 1;
   bs.types.XBTPrice       price          = 2;
   bs.types.XBTAmountValue xbt_amount     = 3;
   bs.types.FXAmountValue  eur_amount     = 4;
   string                  deposit_id     = 5;
   string                  access_token   = 6;
}

message GenoaRegisterXBTDepositResponse
{
   bool     result         = 1;
   string   error_message  = 2;
}

message GenoaConfirmXBTDepositRequest
{
   string deposit_id       = 1;
}

message GenoaConfirmXBTDepositResponse
{
   bool     result         = 1;
   string   error_message  = 2;
}
message GenoaRegiserXBTWithdrawRequest
{
   uint32                  entity_id     = 1;
   bs.types.XBTPrice       price         = 2;
   bs.types.XBTAmountValue xbt_amount    = 3;
   bs.types.FXAmountValue  eur_amount    = 4;
   string                  deposit_id    = 5;
   bs.types.XBTAmountValue fee           = 6;
   string                  access_token  = 7;
}

message GenoaRegiserXBTWithdrawResponse
{
   bool     result         = 1;
   string   error_message  = 2;
}

message GenoaConfirmXBTWithdrawRequest
{
   string deposit_id = 1;
}

message GenoaConfirmXBTWithdrawResponse
{
   bool     result         = 1;
   string   error_message  = 2;
}

message GenoaReportRejectedDepositRequest
{
   uint32 entity_id        = 1;
   string tx_id            = 2;
   string return_address   = 3;
   uint64 validation_score = 4;
}

message GenoaGeneralResponse
{
   bool     result         = 1;
   string   error_message  = 2;
}

message GenoaTradeHistoryRequest
{
   uint32 entity_id = 1;
   uint32 limit = 2;
   uint32 offset = 3;
}

message GenoaTradeHistoryResponse
{
   repeated GenoaOrderData orders = 1;
   uint32 count = 2;
   bool loaded = 3;
}

message GenoaTransactionsForEntityRequest
{
   uint32 entity_id = 1;
   uint32 limit = 2;
   uint32 offset = 3;
}

message GenoaTransactionsForEntityResponse
{
   uint32 entity_id = 1;
   Blocksettle.Communication.ApiServer.Response.TransactionsForEntity result = 2;
}

message GenoaGetStatementDatesRequest
{
   uint32 entity_id = 1;
   string start_date = 2;
   string end_date = 3;
}

message GenoaGetStatementDatesResponse
{
   uint32 entity_id = 1;
   Blocksettle.Communication.ApiServer.Response.GetStatementDates result = 2;
}

message GenoaGetStatementsRequest
{
   uint32 entity_id = 1;
   string date = 2;
}

message GenoaGetStatementsResponse
{
   Blocksettle.Communication.ApiServer.Response.GetStatements result = 2;
}

message GenoaRegisterFcmRequest
{
   uint32 entity_id = 1;
   string token = 2;
}

message GenoaRegisterFcmResponse
{
   bool success = 1;
   string error_msg = 2;
}


message GenoaUnregisterFcmRequest
{
   string token = 1;
}

message GenoaUnregisterFcmResponse
{
   bool success = 1;
   string error_msg = 2;
}


message GenoaSendFcmRequest
{
   uint32 entity_id = 1;
   string title = 2;
   string body = 3;
}

message GenoaSendFcmResponse
{
   bool success = 1;
   string error_msg = 2;
}

message GenoaMessage
{
   message FutureMoveReservationsRequest
   {
      uint32   novation_account_id     = 1;
      uint32   novation_entity_id      = 2;
      string   product_name            = 3;
      repeated string reservation_ids  = 4;
   }

   message FutureMoveReservationsResponse
   {
      message AccountData {
         uint32                 account_id = 1;
         uint32                 entity_id  = 2;
         bs.types.FXAmountValue amount     = 3;
      }

      bool                 success        = 1;
      string               error_message  = 2;
      repeated AccountData accounts       = 3;
   }

   message FuturePayoutRequest
   {
      message Payout {
         // GenoaAdapter will populate that field and pass down to genoa bus
         uint32                 entity_id   = 2;
         bs.types.FXAmountValue amount      = 3;
      }

      string   product_name         = 1;
      string   currency             = 2;
      int64    novation_account_id  = 3;
      repeated Payout user_payout   = 4;
   }

   message FuturePayoutResponse
   {
      message AccountBalance {
         uint32 entity_id = 1;
         bs.types.FXAmountValue amount      = 2;
      }

      bool     success        = 1;
      string   currency       = 2;
      string   error_message  = 3;
      repeated AccountBalance account_balances = 4;
   }

   message FutureCreateReservations
   {
      message AccountMargin {
         // GenoaAdapter will populate that field and pass down to genoa bus
         uint32                 entity_id       = 2;
         bs.types.FXAmountValue amount          = 3;
         int64                  position_id     = 4;
         // reservation_ref - genoa reservation reference ID. always empty for
         // rollover reservations. Could be non-empty for trades only in case
         // user already have a reservation in current session/product
         string                 reservation_ref = 5;
      }

      string product_name              = 1;
      string currency                  = 2;
      repeated AccountMargin margins   = 3;
   }

   message FutureCreateReservationsResponse
   {
      message ReservationInfo
      {
         uint32   entity_id         = 2;
         int64    position_id       = 3;
         string   reservation_ref   = 4;
      }

      message EntityBalance
      {
         uint32                 entity_id   = 1;
         string                 currency    = 2;
         bs.types.FXAmountValue balance     = 3;
      }

      message RecordsCausedFailure
      {
         uint32                 entity_id         = 1;
         string                 currency          = 2;
         bs.types.FXAmountValue expected_balance  = 3;
      }

      bool                          reservation_succeed  = 1;
      string                        error_message        = 2;
      int64                         processing_time_ms   = 3;

      repeated ReservationInfo      reservations_info    = 4;
      repeated EntityBalance        current_balances     = 5;
      repeated RecordsCausedFailure rejected_entities    = 6;
   }

   message NewNovationAccountRequest
   {
      string product_name = 1;
      uint64 session_id = 2;
   }

   message NewNovationAccountResponse
   {
      bool     account_created   = 1;
      string   error_message     = 2;
      uint32   account_id        = 3;
      uint32   entity_id         = 4;
   }

   message DisposeNovationAccountRequest
   {
      int64 account_id = 1;
   }

   message DisposeNovationAccountResponse
   {
      bool     account_disposed  = 1;
      string   error_message     = 2;
   }

   message LoadNovationAccountInfoRequest
   {
      int64 account_id = 1;
   }

   message LoadNovationAccountInfoResponse
   {
      bool                    loaded            = 1;
      bool                    account_opened    = 2;
      bs.types.FXAmountValue  account_balance   = 3;
   }

   GenoaType type = 1;
   oneof data {
      GenoaDisconnectedBroadcast       disconnected               = 2;
      GenoaXBTReservationsResponse     xbt_reservations           = 3;
      GenoaCCReservationResponse       cc_reservations            = 4;
      GenoaCancelCCReservationRequest  cancel_cc_res_request      = 5;
      GenoaCancelCCReservationResponse cancel_cc_res_response     = 6;
      GenoaUserRequest                 user_request               = 7;
      GenoaFindOrdersResponse          find_orders_response       = 8;
      GenoaTradingStatusResponse       trd_status_response        = 9;
      TradeDataXbtMessage              xbt_reserve_request        = 10;
      GenoaReserveXbtResponse          xbt_reserve_response       = 11;
      GenoaUpdateReserveRequest        update_reservation_request = 12;
      bool                             success_response           = 13;
      TradeDataMessage                 fx_trade_request           = 14;
      GenoaFxTradeResponse             fx_trade_response          = 15;
      GenoaTradeXbtUpdateRequest       xbt_trade_update           = 16;
      GenoaXbtCompleteTransferResponse xbt_transfer_complete      = 17;
      GenoaAccountMessage              account                    = 18;
      CustomerAccountData              new_account                = 19;
      GenoaAccountsBalanceUpdate       balance_update             = 20;
      GenoaSendCCTokenRequest          cc_token                   = 21;
      TradeInfoCcData                  cc_reserve                 = 22;
      string                           settlement_id              = 23;
      string                           user_email                 = 24;
      GenoaAccountInfoResponse         user_account_response      = 25;
      GenoaAccountBalanceRequest       acc_balance_request        = 26;
      GenoaAccountBalanceResponse      acc_balance_response       = 27;
      GenoaEODUpdateMessage            eod_update                 = 28;
      GenoaApiKeyCheckRequest          api_key_request            = 29;
      GenoaApiKeyCheckResponse         api_key_response           = 30;
      UserEntityInfo                   entity_info                = 31;
      GeanoReserveCCResponse           cc_reserve_response        = 32;
      uint32                           entity_id                  = 33;

      SetDeliveryAddress               set_delivery_address          = 34;
      SetDeliveryAddressResponse       set_delivery_address_response = 35;

      LoadAllObligationsResponse       loaded_obligations            = 36;
      SettleDelivery                   settle_delivery_status        = 37;

      GenoaCreateIbanAgreementUrlRequest     create_iban_agreement_req        = 38;
      GenoaCreateIbanAgreementUrlResponse    create_iban_agreement_resp       = 39;
      GenoaGetIbanAccountsRequest            get_iban_accounts_req            = 40;
      GenoaGetIbanAccountsResponse           get_iban_accounts_resp           = 41;
      GenoaGetIbanAccountDetailsRequest      get_iban_account_details_req     = 42;
      GenoaGetIbanAccountDetailsResponse     get_iban_account_details_resp    = 43;
      GenoaUserNotifyMsg                     user_notify                      = 44;

      GenoaListApiKeysRequest                list_api_keys_req                = 45;
      GenoaListApiKeysResponse               list_api_keys_resp               = 46;

      GenoaCreateExternalAccountRequest         create_external_account_req        = 47;
      GenoaCreateExternalAccountResponse        create_external_account_resp       = 48;

      GenoaRegisterXBTDepositRequest            xbt_register_deposit_request     = 49;
      GenoaRegisterXBTDepositResponse           xbt_register_deposit_response    = 50;
      GenoaConfirmXBTDepositRequest             xbt_confirm_deposit_request      = 51;
      GenoaConfirmXBTDepositResponse            xbt_confirm_deposit_response     = 52;

      GenoaRegiserXBTWithdrawRequest            xbt_register_withdraw_request    = 53;
      GenoaRegiserXBTWithdrawResponse           xbt_register_withdraw_response   = 54;
      GenoaConfirmXBTWithdrawRequest            xbt_confirm_withdraw_request     = 55;
      GenoaConfirmXBTWithdrawResponse           xbt_confirm_withdraw_response    = 56;

      GenoaReportRejectedDepositRequest         report_rejected_deposit          = 57;
      GenoaGeneralResponse                      report_rejected_deposit_response = 58;
      GenoaTradeHistoryRequest                  trade_history                    = 59;
      GenoaTradeHistoryResponse                 trade_history_response           = 60;
      GenoaTransactionsForEntityRequest         transactions_for_entity          = 61;
      GenoaTransactionsForEntityResponse        transactions_for_entity_response = 62;
      GenoaGetStatementDatesRequest             get_statement_dates              = 63;
      GenoaGetStatementDatesResponse            get_statement_dates_response     = 64;
      GenoaGetStatementsRequest                 get_statements                   = 65;
      GenoaGetStatementsResponse                get_statements_response          = 66;

      FutureMoveReservationsRequest             future_move_reservations_request    = 67;
      FutureMoveReservationsResponse            future_move_reservations_response   = 68;

      FuturePayoutRequest                       future_payout_request               = 69;
      FuturePayoutResponse                      future_payout_response              = 70;

      FutureCreateReservations                  future_create_reservations          = 71;
      FutureCreateReservationsResponse          future_create_reservations_response = 72;

      NewNovationAccountRequest                 new_novation_account_request        = 73;
      NewNovationAccountResponse                new_novation_account_response       = 74;

      DisposeNovationAccountRequest             dispose_novation_account            = 75;
      DisposeNovationAccountResponse            dispose_novation_account_response   = 76;

      GenoaRegisterFcmRequest                   register_fcm_request                = 77;
      GenoaRegisterFcmResponse                  register_fcm_response               = 78;
      GenoaUnregisterFcmRequest                 unregister_fcm_request              = 79;
      GenoaUnregisterFcmResponse                unregister_fcm_response             = 80;
      GenoaSendFcmRequest                       send_fcm_request                    = 81;
      GenoaSendFcmResponse                      send_fcm_response                   = 82;

      LoadNovationAccountInfoRequest            load_novation_account_info          = 83;
      LoadNovationAccountInfoResponse           novation_account_info               = 84;
   }
}

enum GenoaServerType
{
   GenoaServerResponse              = 0;
   GenoaServerNewClient             = 1;
   GenoaServerUpdBalance            = 2;
   GenoaServerUpdTrdStatus          = 3;
   GenoaServerXbtTrdStatus          = 4;
   GenoaServerNewCcSeed             = 5;
   GenoaServerNewCCDeposit          = 6;
   GenoaServerCashResBalance        = 7;
   GenoaServerDepositNotification   = 8;
}

message GenoaServerClientRequest
{
   string email = 1;
}

message GenoaServerBalanceUpdate
{
   uint32 entity_id = 1;
   string currency = 2;
   bs.types.FXAmountValue balance = 3;
}

message GenoaServerCashResBalanceUpdate
{
   message BalanceUpdate
   {
      uint32                  entity_id   = 1;
      int64                   currency_id = 2;
      bs.types.FXAmountValue  balance     = 3;
   }

   repeated BalanceUpdate update = 1;
}

message GenoaServerTradingStatusUpdate
{
   uint32 entity_id = 1;
   bool   trading_enabled = 2;
}

message GenoaServerXbtTradingStatus
{
   uint32 entity_id = 1;
   string status = 2;
}

message GenoaServerNewCcSeedRequest
{
   string      cc_name        = 2;
   string      correlation_id = 3;
   double      initial_price  = 4;
   uint32      lot_size       = 5;
}

message GenoaServerNewCCDepositRequest
{
   uint32      entity_id = 1;
   string      cc_name     = 2;
   uint32      amount      = 3;
   string      correlation_id = 4;
}

message GenoaServerTradeUpdateEvent
{
   uint32            entity_id      = 1;
   bs.types.Action   action         = 2;
   bs.types.Order    order          = 3;
}

message GenoaServerDeposit
{
   uint32                  entity_id   = 1;
   string                  ccy         = 2;
   bs.types.FXAmountValue  amount      = 3;
}

message GenoaServerMessage
{
   GenoaServerType type = 1;
   oneof data {
      GenoaServerClientRequest         new_client           = 2;
      GenoaServerBalanceUpdate         balance_update       = 3;
      GenoaServerTradingStatusUpdate   trd_status           = 4;
      GenoaServerXbtTradingStatus      xbt_trd_status       = 5;
      GenoaServerNewCcSeedRequest      new_cc_seed          = 6;
      GenoaServerNewCCDepositRequest   new_cc_deposit       = 7;
      GenoaServerCashResBalanceUpdate  cash_res_balance_upd = 8;
      GenoaServerDeposit               deposit_notification = 9;

      bool                             response             = 50;
   }
}


enum MktDataType
{
   MktDataUnknownType  = 0;
   MktDataReconnect    = 1;
   MktDataConnected    = 2;
   MktDataDisconnected = 3;
   MktDataUpdate       = 4;
}

message MktDataUpdateMessage
{
   message MktDataField
   {
      int32  type             = 1;
      double value            = 2;
      string level_quantity   = 3;
   }
   int32  asset      = 1;
   string security   = 2;

   repeated MktDataField fields = 3;
}

message MktDataMessage
{
   MktDataType type = 1;
   oneof data {
      MktDataUpdateMessage update = 2;
   }
}


enum CelerType
{
   CelerUnknownType              = 0;
   CelerClientConnected          = 1;
   CelerReconnect                = 2;
   CelerClientDisconnected       = 3;
   CelerMerchantConnected        = 4;
   CelerMerchantDisconnected     = 5;
   CelerPiggyBankConnected       = 6;
   CelerPiggyBankDisconnected    = 7;
   CelerDataConnected            = 8;
   CelerDataDisconnected         = 9;
   CelerSetUserProperties        = 10;
   CelerUpdateBalance            = 11;
   CelerSaveTrade                = 12;
   CelerSaveCcTrade              = 13;
   CelerNewCCCreated             = 15;
   CelerCreateUser               = 16;
   CelerSubscribeMerchant        = 17;
   CelerVerifyXBTQuote           = 18;
   CelerVerifyXBTQuoteRequest    = 19;
   CelerReserveCashForXBTRequest = 20;
   CelerXBTTradeRequestType      = 21;
   CelerFxTradeRequestType       = 22;
   CelerVerifyCCQuote            = 23;
   CelerVerifyCCQuoteRequest     = 24;
   CelerVerifyCCAcceptedQuote    = 25;
   CelerCCTradeRequest           = 26;
   CelerWarehouseConfiguration   = 27;
   CelerSecurityDefinition       = 28;
   CelerGetBalanceRequest        = 29;
   CelerGetAccountsRequest       = 30;
   CelerNewAccountAck            = 31;
   CelerGetUserProperty          = 32;
   CelerRegisterCCDefinition     = 33;
   CelerCheckUser                = 34;
   CelerRawDataType              = 50;
}

message SavedTradeInfoMessage
{
   string product = 1;
   double price = 2;
   oneof qty {
      double amount = 3;
      uint64 quantity = 4;
   }
   bool   is_sell = 5;
   string trade_id = 6;
   uint64 timestamp = 7;
}


enum TradeHistType
{
   TradeHistReconnect               = 0;
   TradeHistSaveFxTrade             = 1;
   TradeHistSaveXbtTrade            = 2;
   TradeHistSaveCcTrade             = 3;
   TradeHistSaveFutureTrade         = 4;
   TradeHistSaveTradeResult         = 6;
   TradeHistRequestLastTrade        = 7;
   TradeHistRequestLastBuySellTrade = 8;
   TradeHistRequestSnapshot         = 9;
   TradeHistRequestCcPrices         = 10;
   TradeHistRequestEOD              = 11;
   TradeHistRequestEODSnapshot      = 12;
   TradeHistorySetInitialPrice      = 13;
   TradeHistEODEvent                = 14;
   TradeHistPriceBookUpdate         = 15;
}

message TradeDataMessage
{
   string product = 1;
   int64  sequence_num = 2;
   string cl_ord_id = 3;
   uint32 sell_entity_id = 4;
   uint32 buy_entity_id = 5;
   string sell_trade_account = 6;
   string buy_trade_account = 7;
   double sell_amount = 8;
   double buy_amount = 9;
   string sell_currency = 10;
   string buy_currency = 11;
   string asset_currency = 12;
   string num_currency = 13;
   int64  trade_timestamp = 14;
}

message BalanceData
{
   string currency = 1;
   bs.types.FXAmountValue balance = 2;
}

message CustomerAccountData
{
   string email = 1;
   string email_hashed = 2;
   string entity_name = 3;
   uint32 entity_id = 4;
   string settlement_account = 5;
   uint32 settlement_acc_id = 6;
   string trading_account = 7;
   uint32 trading_acc_id = 8;
   repeated BalanceData balances = 9;
   repeated BalanceData im_balances = 10;
}

message TradeDataXbtMessage
{
   int32  subsystem = 1;
   string settlement_id = 2;
   string cl_order_id = 3;
   bool   requestor_sells = 4;
   string requestor_pub_key = 5;
   string dealer_pub_key = 6;
   CustomerAccountData requestor = 7;
   CustomerAccountData dealer = 8;
   bs.types.XBTAmountValue xbt_amount = 9;
   bs.types.FXAmountValue ccy_amount = 10;
   bs.types.XBTPrice price = 11;
   string product = 12;
   string currency = 13;
   bytes  unsigned_payin = 14;
   bytes  signed_payin = 15;
   bytes  signed_payout = 16;
   bytes  payin_hash = 17;
   uint64 total_payin_fee = 18;
   uint64 timestamp = 19;
   string settlement_address = 20;
   int32  avg_score = 21;
   int32  min_score = 22;
   string scorechain_url = 23;
   bool   loaded_from_genoa = 24;
   string last_status = 25;
   bool   saved_in_history = 27;
   int32  trade_state = 28;
   bool payin_broadcasted_by_user = 29;
   bool payout_broadcasted_by_user = 30;
   bool cash_reserved = 31;
   uint64 next_timeout_timestamp = 32;
   repeated bytes rejected_inputs = 33;
}

message TradeInfoCcData
{
   string cl_ord_id = 1;
   CustomerAccountData requester = 2;
   CustomerAccountData dealer = 3;
   bool   requester_buys = 4;
   string currency = 5;
   double quantity = 6;
   double price = 7;
   bytes  requester_tx_data = 8;
   string requester_recpt_address = 9;
   bytes  dealer_tx_data = 10;
   string dealer_recpt_address = 11;
   int32  validation_score = 12;
   string scorechain_url = 13;
   uint64 timestamp = 14;
   bool   saved_in_history = 15;
}

message OutPointData
{
   bytes  hash = 1;
   uint32 index = 2;
   uint32 tx_height = 3;
   uint32 tx_index = 4;
   uint64 value = 5;
   bool   spent = 6;
   bytes  spender_hash = 7;
}

message TradeDataCcMessage
{
   TradeInfoCcData cc_trade_info = 1;
   string       sell_address = 2;
   string       buy_address = 3;
   bytes        tx = 4;
   string       tx_id = 5;
   repeated OutPointData outpoints = 6;
   OutPointData return_outpoint = 7;
   uint64       zc_timestamp = 8;
}

message TradeHistResponse
{
   bool success = 1;
}

message TradeHistRequest
{
   int32  trade_type = 1;
   string product = 2;
   uint64 from_timestamp = 3;
   uint64 to_timestamp = 4;
}

message TradeHistBuySellResponse
{
   bytes buy_trade = 1;
   bytes sell_trade = 2;
}

message TradeHistSnapshotResponse
{
   repeated bytes trades = 1;
}

message TradeHistPricesResponse
{
   bool   price_set     = 1;
   double bid_price     = 2;
   double offer_price   = 3;
}

message SetInitialPriceRequest
{
   string cc_name       = 1;
   double bid_price     = 2;
   double offer_price   = 3;
}

message TradeHistEODSnapshotResponse
{
    message EODSnapshot
    {
       Communication.TradeHistory.DateContainer date  = 1;
       bytes                                    eod   = 2;
    }
    repeated EODSnapshot                     snapshot = 1;
    Communication.TradeHistory.DateContainer req_date = 2;
}

message TradeHistEODUpdate
{
   Communication.TradeHistory.DateContainer  date  = 1;
   bytes                                     eod   = 2;
}

message TradeHistMessage
{
   TradeHistType type = 1;
   oneof data {
      bytes                                        serialized_trade  = 2;
      TradeHistResponse                            response          = 5;
      TradeHistRequest                             hist_request      = 6;
      bytes                                        last_trade        = 7;
      TradeHistBuySellResponse                     buy_sell_trades   = 8;
      TradeHistSnapshotResponse                    trades_snapshot   = 9;
      TradeHistPricesResponse                      prices            = 10;
      Communication.TradeHistory.DateContainer     eod_request       = 11;
      bytes                                        eod_data          = 12;
      TradeHistEODSnapshotResponse                 eod_snapshot      = 13;
      SetInitialPriceRequest                       set_initial_price = 14;
      TradeHistEODUpdate                           eod_update        = 15;
      Communication.TradeHistory.PriceBookUpdate   price_book_update = 16;
   }
}


enum SettlementTxType
{
   SettlementTxUnknownType          = 0;
   SettlementTxUnsignedPayinTimeout = 1;
   SettlementTxSignedPayinTimeout   = 2;
   SettlementTxPayoutTimeout        = 3;
   SettlementTxCcMatchTimeout       = 4;
   SettlementTxCcHandshakeTimeout   = 6;
   SettlementTxDelayedCancel        = 7;
}


message SettlementTxMessage
{
   SettlementTxType type = 1;
   oneof data {
      string trade_id = 2;
   }
}


enum TerminalMessageType
{
   TerminalUnknownType              = 0;
   TerminalUnsignedPayinRequest     = 2;
   TerminalSignedPayinRequest       = 3;
   TerminalSignedPayoutRequest      = 4;
   TerminalXBTTradeCancel           = 5;
   TerminalCCTradeCancel            = 6;
   TerminalOtcStart                 = 10;
   TerminalOtcVerify                = 11;
   TerminalOtcSealPayin             = 12;
   TerminalOtcTxProcess             = 13;
   TerminalOtcCancel                = 14;
   TerminalOtcUpdate                = 15;
   TerminalUpdateBalance            = 16;
   TerminalOTCcVerify               = 17;
   TerminalOTCcAccept               = 18;
   TerminalOTCcTrade                = 19;
   TerminalUpdateBlotterForEntities = 21;
   TerminalReportDelivery           = 22;
   TerminalUpdateTrade              = 23;
}

message PreimageData {
   string address = 1;
   bytes data = 2;
}

message TerminalUnsignedPayin
{
   string settlement_id = 1;
   repeated PreimageData preimage_data = 2;
   bytes unsigned_payin = 3;
}

message TerminalSignedData
{
   string settlement_id = 1;
   bytes data = 2;
}

message TerminalSignPayinRequest
{
   string settlement_id = 1;
   bytes  unsigned_payin = 2;
   bytes  payin_hash = 3;
}

message TerminalOtcStartRequest
{
   int32 request_id = 1;
   bool  is_cc = 2;
}

message TerminalOtcStartResponse
{
   int32  request_id = 1;
   string settlement_id = 2;
}

message TerminalOtcVerifyRequest
{
   bool   is_sell = 1;
   string settlement_id = 2;
   bytes  payin_tx_hash = 3;
   bytes  seller_auth_pubkey = 4;
   bytes  buyer_auth_pubkey = 5;
   int64  price = 6;
   int64  amount = 7;
   string chat_id_seller = 8;
   string chat_id_buyer = 9;
   bytes  unsigned_payin = 10;
   repeated PreimageData preimage_data = 11;
}

message TerminalOtcUpdateMessage
{
   string settlement_id = 1;
   int32  state = 2;
   string error_text = 3;
   uint64 timestamp = 4;
}

message TerminalOtcTxMessage
{
   string settlement_id = 1;
   bytes  signed_tx = 2;
}

message TerminalOTCcVerifyRequest
{
   bool   is_sell = 1;
   string settlement_id = 2;
   string cc = 3;
   bytes  cc_tx_half = 4;
   string receipt_address = 5;
   uint32 amount = 6;
   uint64 price = 7;
   string chat_id_user = 8;
}

message TerminalOTCcSignedTX
{
   string settlement_id = 1;
   bytes  signed_tx = 2;
}

message TerminalUpdateBalanceMessage
{
   repeated bs.types.Balance balances = 1;
}

message TerminalDeliveryReport
{
   enum Status {
      INVALID = 0;
      PENDING = 1;
      DELIVERED = 2;
      //REJECTED ?
   }
   int64  entity = 1;
   string id = 2;
   int64  to_deliver = 3;
   string bs_address = 4;
   double price = 5;
   Status status = 6;
}

message TerminalUpdateOrder
{
   bs.types.Order order = 1;
   bs.types.Action action = 2;
}

message TerminalMessage
{
   TerminalMessageType  type           = 1;
   string               address_email  = 2;

   oneof data {
      string                        settlement_id              = 3;
      TerminalUnsignedPayin         unsigned_payin             = 4;
      TerminalSignPayinRequest      sign_payin_request         = 5;
      TerminalSignedData            signed_data                = 6;
      TerminalOtcStartRequest       otc_start                  = 10;
      TerminalOtcStartResponse      otc_response               = 11;
      TerminalOtcVerifyRequest      otc_verify                 = 12;
      TerminalOtcUpdateMessage      otc_update                 = 13;
      TerminalOtcTxMessage          otc_tx                     = 14;
      TerminalUpdateBalanceMessage  update_balance_message     = 15;
      TerminalOTCcVerifyRequest     otcc_verify                = 16;
      TerminalOTCcSignedTX          otcc_tx                    = 17;
      AffectedEntities              entities_to_update         = 20;
      TerminalDeliveryReport        delivery_report            = 21;
      TerminalUpdateOrder           update_order               = 22;
   }
}


enum ProxyMessageType
{
   ProxyUnknownType        = 0;
   ProxyConnected          = 1;
   ProxyDisconnected       = 2;
   ProxyReconnect          = 3;
   ProxyOnlineUsers        = 5;
   ProxyUserStatusUpdated  = 6;
   ProxyOnlineUserStats    = 7;
}

message ProxyOnlineUsersMessage
{
   int32 chat_users = 1;
   int32 market_users = 2;
   int32 trading_users = 3;
   int32 dealing_users = 4;
}

message ProxyUserStatusUpdatedMessage
{
   string email = 1;
   bool enabled = 2;
}

message ProxyMessage
{
   ProxyMessageType type = 1;
   oneof data {
      ProxyOnlineUsersMessage       online_users         = 2;
      ProxyUserStatusUpdatedMessage user_status_updated  = 3;
      uint32                        user_connected = 10; // entity_id
      uint32                        user_disconnected = 11; // entity_id
   }
}


enum WebClientType
{
   WebClientUnknownType = 0;
   WebScorechainUtxoScore = 1;
   WebScorechainCacheTX = 2;
}

message WebScorechainUtxoRequest
{
   repeated string tx_id = 1;
}

message WebScorechainUtxoResponse
{
   bool   success    = 1;
   int32  min_score  = 2;
   string url        = 3;
}

message WebScorechainCacheTxRequest
{
   bytes tx_hash = 1;
   bool  is_payin = 2;
   int32 score = 3;
}

message WebClientMessage
{
   WebClientType type = 1;
   oneof data {
      WebScorechainUtxoRequest  sc_utxo_request = 2;
      WebScorechainUtxoResponse sc_utxo_response = 3;
      WebScorechainCacheTxRequest sc_cache_tx = 4;
   }
}

enum RelayUser
{
   UserUnknown          = 0;
   UserPrivateBridge    = 1;
   UserStorage          = 2;
   UserCCTracker        = 3;
   UserGenoa            = 5;
   UserTradeHist        = 6;
   StreamPriceOffering  = 7;
   PriceAggregationUser = 8;
}

message RelayedMessage
{
   RelayUser user = 1;
   bytes data = 2;
}

message AuthManaging
{
   message AuthAddressConfirm
   {
      string   user     = 1;
      string   address  = 2;
   }

   message SettledXbtTradeNotification
   {
      string settlement_id       = 1;

      string requester_address   = 2;
      string dealer_address      = 3;
   }

   message FilterAuthFundUTXOs
   {
      repeated bytes utxos = 1;
   }

   message AuthConfirmResponse
   {
      int32 result_code = 1;
   }

   oneof data
   {
      AuthAddressConfirm   auth_confirm_request    = 1;
      AuthConfirmResponse  auth_confirm_response   = 2;

      SettledXbtTradeNotification   settled_xbt_trade  = 3;

      FilterAuthFundUTXOs  auth_fund_utxos = 4;

      string               user_promoted_to_dealer = 5;
   }
}

enum ObligationsManagingMessageType
{
   LoadCustomerObligations    = 0;
   CustomerObligation         = 1;
   WhitelistUserAddress       = 2;
   RevokeUserAddress          = 3;
   XBTWithdraw                = 4;
};

message ObligationsManaging
{
   message CustomerObligationsRequest
   {
      uint32 entity_id = 1;
   }

   message CustomerObligationsResponse
   {
      uint32   entity_id      = 1;
      int64    to_deliver     = 2;
      string   bs_address     = 3;
      double   cutoff_price   = 4;
      bool     detected       = 5;
   }

   message CustomerObligationRequest
   {
      uint32   entity_id      = 1;
      string   delivery_id    = 2;
      bs.types.XBTAmountValue value = 3;
      string   bs_address     = 4;
      bs.types.XBTPrice price = 5;
      string   currency       = 6;
   }

   message SubmitWhitelistedAddress
   {
      uint32 entity_id = 1;
      Blocksettle.Communication.ApiServer.Request.WhitelistedAddressRequest  address_data   = 2;
   }

   message SubmitAddressResponse
   {
      // bs::network::SubmitWhitelistedAddressStatus
      int32    status_code = 1;
      uint32   entity_id = 2;
      Blocksettle.Communication.ApiServer.Response.WhitelistedAddressResponse address_data = 3;
   }

   message RevokeUserAddress
   {
      uint32 entity_id     = 1;
      string address       = 2;
   }

   message RevokeUserAddressResponse
   {
      uint32   entity_id   = 1;
      string   address     = 2;
      int32    status_code = 3;
   }

   message XBTWithdrawRequest
   {
      uint32                  entity_id            = 1;
      string                  address              = 2;
      bs.types.FXAmountValue  eur_amount           = 3;
      bs.types.XBTPrice       price                = 4;
      bs.types.XBTAmountValue xbt_receive_amount   = 5;
      bs.types.XBTAmountValue fee_amount           = 6;
   }

   message XBTWithdrawResponse
   {
      uint32                  entity_id   = 1;
      string                  address     = 2;
      bs.types.FXAmountValue  eur_amount  = 3;
      int32                   status_code = 4;
   }

   ObligationsManagingMessageType   type = 1;

   oneof data
   {
      CustomerObligationsRequest    load_obligations_request   = 2;
      CustomerObligationsResponse   load_obligations_response  = 3;
      SubmitWhitelistedAddress      submit_address_request     = 4;
      SubmitAddressResponse         submit_address_response    = 5;
      RevokeUserAddress             revoke_request             = 6;
      RevokeUserAddressResponse     revoke_response            = 7;
      XBTWithdrawRequest            xbt_withdraw_request       = 8;
      XBTWithdrawResponse           xbt_withdraw_response      = 9;
      CustomerObligationRequest     customer_obligation        = 10;
   }
}

message PriceStreamManaging
{
   enum MessageType
   {
      GetBestOfferingPriceForOrder  = 0;
      CleanupExpiredPriceOfferings  = 1;
      PriceConsumed                 = 2;
      SubmitPrices                  = 3;
      PullPrices                    = 4;
      DealerConnected               = 5;
      DealerDisconnected            = 6;
      NetExposureUpdate             = 7;
      TradingStartedUpdate          = 8;
      TradingClosedUpdate           = 9;
      ActiveDealersInfo             = 10;
      GetBestOfferPack              = 11;
   };

   message GetBestOfferRequest
   {
      bs.types.XBTAmountValue xbt_amount              = 1;
      int64                   requesting_entity       = 2;
      bool                    get_ask_price           = 3;
      int32                   price_book              = 4;
      uint32                  price_tolerance_ratio   = 5;
      bs.types.XBTPrice       expected_price          = 6;
   }

   message GetBestOfferResponse
   {
      message PriceOffer
      {
         uint32                  owner_entity_id = 1;
         bs.types.XBTPrice       price           = 2;
         uint64                  timestamp       = 3;
         bs.types.XBTAmountValue max_amount      = 4;
      }

      bs.types.XBTAmountValue xbt_amount     = 1;
      PriceOffer              best_offer     = 2;
      bool                    matched        = 3;
   }

   message GetBestOfferPackRequest
   {
      bs.types.XBTAmountValue xbt_amount        = 1;
      int64                   requesting_entity = 2;
      bool                    get_ask_price     = 3;
      int32                   price_book        = 4;
      int32                   offers_depth      = 5;
   }

   message GetBestOfferPackResponse
   {
      message Offer
      {
         bs.types.XBTPrice       offer_price       = 1;
         bs.types.XBTAmountValue max_offer_amount  = 2;
      }

      repeated Offer offers = 1;
   }

   message ClientData
   {
      bytes    client_id   = 1;
      bytes    client_data = 2;
   }

   message PriceConsumedData
   {
      uint32 owner_entity_id = 1;
      uint64 timestamp       = 2;
      int32  product_type    = 3; // bs::network::asset::type
   }

   message StreamPriceData
   {
      bs.types.XBTAmountValue volume   = 1;
      bs.types.XBTPrice       ask      = 2;
      bs.types.XBTPrice       bid      = 3;
   }

   message SubmitPricesData
   {
      string                     product_type   = 1;
      repeated StreamPriceData   prices         = 2;
   }

   message SubmitPricesRequest
   {
      uint32           owner_entity_id   = 1;
      SubmitPricesData submit_price_data = 2;
   }

   message SubmitPricesResponse
   {
      uint32                               owner_entity_id     = 1;
      bs.types.SubmitPriceProcessingResult result              = 2;
      bs.types.SubmitPriceRejectReason     reject_reason       = 3;
      string                               product_type        = 4;
      repeated StreamPriceData             rejected_prices     = 5;
   }

   message PullPricesRequest
   {
      uint32                     owner_entity_id = 1;
      bs.types.PullPricesData    pull_price_data = 2;
   }

   message NetExposureChangedUpdate
   {
      uint32                  entity_id    = 1;
      int32                   product_type = 2; // bs::fut::Product
      bs.types.XBTAmountValue net_exposure = 3;
   }

   message TradingStartedNotification
   {
      int32                   product_type   = 1; // bs::fut::Product
      bs.types.XBTPrice       session_im     = 2;
   }

   message TradingClosedNotification
   {
      int32                   product_type   = 1; // bs::fut::Product
   }

   message ActiveDealersInfoSnapshot
   {
      message ProductDealersInfo
      {
         uint32  product_type    = 1; // bs::fut::Product
         uint32  dealers_count   = 2;
      }

      repeated ProductDealersInfo dealers_info = 1;
   }

   MessageType   message_type = 1;

   oneof data
   {
      GetBestOfferRequest        get_best_price_offer    = 2;
      GetBestOfferResponse       best_price_offer        = 3;
      ClientData                 client_data             = 4;
      PriceConsumedData          consumed_price          = 5;
      uint32                     entity_id               = 6;
      SubmitPricesRequest        submit_prices           = 7;
      SubmitPricesResponse       submit_prices_response  = 8;
      PullPricesRequest          pull_prices             = 9;
      NetExposureChangedUpdate   net_exposure_update     = 10;
      TradingStartedNotification trading_started         = 11;
      TradingClosedNotification  trading_closed          = 12;
      ActiveDealersInfoSnapshot  dealers_info            = 13;
      GetBestOfferPackRequest    get_offers_request      = 14;
      GetBestOfferPackResponse   get_offers_response     = 15;
   }
}


message ApiServerMsg
{
   message UpdateOrder
   {
      uint32 entity_id = 1;
      bs.types.Order order = 2;
      bs.types.Action action = 3;
   }

   message TradingSessionClosed
   {
      int32 product_type = 1; // bs::network::Asset::Type
   }

   message UserNotify
   {
      uint32   broadcast_to   = 1; // entity_id
      string   message        = 2;
      string   code           = 3;
      string   type           = 4;
   }

   message UpdateWithdrawPrices
   {
      bs.types.XBTPrice       sell_price     = 1;
      bs.types.XBTPrice       buy_price      = 2;
      bs.types.XBTAmountValue network_fee    = 3;
      bs.types.XBTAmountValue min_xbt_amount = 4;
   }

   message UpdateBalances
   {
      uint32 entity_id = 1;
      repeated bs.types.Balance balances = 2;
   }

   message OpenInterestUpdate
   {
      int32                   product_type   = 1; // bs::network::Asset::Type
      bs.types.XBTAmountValue open_interest  = 2;
   }

   message BestPriceUpdate
   {
      int32                book_type   = 1;
      bs.types.XBTPrice    bid         = 2;
      bs.types.XBTPrice    ask         = 3;
   }

   message ClientConnected
   {
      bytes  client_id = 1;
      string ip_address = 2;
   }

   message ClientRequest
   {
      bytes client_id = 1;
      bytes message = 2;
   }

   message ConnectedClientsSnapshot
   {
      message ConnectedClientsInfo
      {
         string endpoint_name       = 1;
         uint32 active_connections  = 2;
      }

      repeated ConnectedClientsInfo connection_info = 1;
   }

   oneof data
   {
      UpdateOrder                update_order            = 1;
      BestPriceUpdate            best_price_update       = 2;
      TradingSessionOpen         trading_opened          = 3;
      TradingSessionClosed       trading_closed          = 4;
      Empty                      send_prices             = 5;
      Empty                      send_trading_stats      = 6;
      uint32                     user_connected          = 7;   // entity_id
      uint32                     user_disconnected       = 8;   // entity_id
      UserNotify                 user_notify             = 9;
      UpdateWithdrawPrices       update_withdraw_prices  = 10;
      Empty                      subscribe_price_offers  = 11;
      BestPriceUpdate            price_offer             = 12;
      UpdateBalances             update_balances         = 13;
      OpenInterestUpdate         update_open_interest    = 14;
      bytes                      expire_user_session     = 15;  // client id
      ClientConnected            client_connected        = 16;
      bytes                      client_disconnected     = 17;  // client id
      ClientRequest              client_request          = 18;
      bytes                      mdhs_data               = 19;
      Empty                      load_connections_info   = 20;
      ConnectedClientsSnapshot   connections_info        = 21;
   }
}


message UsersImInfo
{
   message InfoIM {
      message PerProduct {
         int32  product_type = 1;
         bs.types.XBTAmountValue net_exposure = 2;
         double leverage_ratio = 3;
         bs.types.FXAmountValue balance = 4;
         bs.types.FXAmountValue im_balance = 5;
         bs.types.FXAmountValue profit_loss = 6;
      }
      string account_name = 1;
      repeated PerProduct per_product = 2;
      bs.types.FXAmountValue im_balance = 3;
      bs.types.FXAmountValue balance = 4;
      bs.types.FXAmountValue profit_loss = 5;
   }
   repeated InfoIM im_info = 1;
   repeated string connected_users = 2;
   repeated string lp_streaming_users = 3;

   message OpenInterest {
      int32  product_type = 1;
      bs.types.FXAmountValue buy = 2;
      bs.types.FXAmountValue sell = 3;
   }
   repeated OpenInterest open_interest = 4;
}

message TradingSessionOpen
{
   string            product_name         = 1;
   int64             cut_off_at           = 2;
   double            seconds_to_cut_off   = 3;
   bs.types.XBTPrice fee_taker            = 4;
   bs.types.XBTPrice fee_maker            = 5;
   bs.types.XBTPrice open_price           = 6;
   bool              trading_enabled      = 7;
}

message CashResMessage
{
   message Order
   {
      uint32                  entity_id               = 1;
      bs.types.XBTAmountValue qty                     = 2;
      bool                    is_max_qty              = 3;
      bs.types.XBTPrice       price                   = 4;
      int32                   trade_type              = 5;
      string                  cl_ord_id               = 6;
      int64                   timestamp               = 7;
      bool                    is_rollover             = 8;
      bs.types.FXAmountValue  im                      = 9;
      bool                    is_LP                   = 10;
      // cut_off_price going to be deprectaed
      // used by genoa adapter when creating response on loading orders
      // positions history for futures should come from FS
      bs.types.XBTPrice       cut_off_price           = 11;
      bool                    reservation_confirmed   = 12;
      int64                   position_id             = 13;
      bs.types.XBTAmountValue reference_exposure      = 14;
   }

   message EstimateImRequest
   {
      uint32                  entity_id = 1;
      string                  product   = 2;
      bs.types.XBTAmountValue qty       = 3;
      bs.types.Side           side      = 4;
      bs.types.XBTPrice       price     = 5;
   }

   message EstimateImResponse
   {
      EstimateImRequest      request    = 1;
      bool                   success    = 2;
      bs.types.FXAmountValue im_balance = 3;
      string                 error_text = 4;
   }

   message MaxAmountRequest
   {
      message Offer
      {
         bs.types.XBTPrice       offer_price       = 1;
         bs.types.XBTAmountValue max_offer_amount  = 2;
      }

      uint32 entity_id = 1;
      int32  prod_type = 2;
      bs.types.Side side = 3;
      repeated Offer offers = 4;
   }

   message MaxAmountResponse
   {
      bool success = 6;
      string error_msg = 7;
      uint32 entity_id = 1;
      int32  prod_type = 2;
      bs.types.Side side = 3;
      bs.types.XBTAmountValue max_amount = 4;
      bs.types.FXAmountValue fee = 5;
   }

   message OrderResponse
   {
      string   cl_ord_id   = 1;
      bool     success     = 2;
      string   error_text  = 3;
      int64    position_id = 4;
      bs.types.XBTAmountValue qty = 5;
   }

   message OrdersRequest
   {
      uint32 entity_id = 1;
      int32  product_type = 2;
   }

   message OrdersResponse
   {
      bool   loaded = 1;
      string error_text = 2;
      uint32 entity_id = 3;
      repeated Order orders = 4;
   }

   message FeeRequest
   {
      string product_name = 1;
   }

   message FeeResponse
   {
      string            product_name      = 1;
      bool              success           = 2;
      string            error_msg         = 3;
      bs.types.XBTPrice fee               = 4;
      bs.types.XBTPrice dealer_commission = 5;
      string            fee_ccy           = 6;
      bs.types.XBTPrice im                = 7;
   }

   message LoadBalancesResponse
   {
      uint32               entity_id = 1;
      repeated BalanceData balances  = 2;
   }

   message TradeFeeForEntityRequest
   {
      uint32 entity_id = 1;
      uint32 limit = 2;
      uint32 offset = 3;
   }

   message TradeFeeForEntityResponse
   {
      uint32 entity_id = 1;
      Blocksettle.Communication.ApiServer.Response.TradeFeeForEntity result = 2;
   }

   message SessionInfoSnapshot
   {
      message SessionInfo
      {
         string            product_name      = 1;
         string            session_state     = 2;
         uint64            start_timestamp   = 3;
         uint64            end_timestamp     = 4;
         bs.types.XBTPrice open_price        = 5;
      }

      repeated SessionInfo session_info = 1;
   }

   message RevertDamagedSessionRequest
   {
      string   product_name   = 1;
   }

   message RevertDamagedSessionResult
   {
      string   product_name         = 1;
      bool     revert_successfull   = 2;
      string   error_message        = 3;
   }

   oneof data {
      EstimateImRequest          estimate_im_request     = 1;
      EstimateImResponse         estimate_im_response    = 2;

      MaxAmountRequest           max_amount_request      = 3;
      MaxAmountResponse          max_amount_response     = 4;
      // users_im_info - deprecated
      UsersImInfo                users_im_info           = 5;

      string                     get_session_info        = 6; // product type for now
      TradingSessionOpen         session_info_response   = 7;

      Order                      append_order            = 8;
      OrderResponse              order_response          = 9;

      Empty                      session_event           = 10;

      OrdersRequest              orders_request          = 11;
      OrdersResponse             orders_response         = 12;

      FeeRequest                 fee_request             = 13;
      FeeResponse                fee_response            = 14;

      string                     process_next_order      = 15;

      int64                      load_balances           = 16; // entity id
      LoadBalancesResponse       load_balances_response  = 17;

      TradeFeeForEntityRequest   trade_fee_request       = 18;
      TradeFeeForEntityResponse  trade_fee_response      = 19;

      Empty                      load_sessions_snapshot  = 20;
      SessionInfoSnapshot        session_snapshot        = 21;

      RevertDamagedSessionRequest   revert_session_request  = 22;
      RevertDamagedSessionResult    revert_session_response = 23;

      string                        session_name            = 24;
   }
}


message DealerConnMessage
{
   message OrderRequest
   {
      string                  product = 1;
      bs.types.XBTAmountValue qty = 2;
      bs.types.Side           side = 3;
   }

   message OrderResponse
   {
      bool                    success           = 1;
      string                  product           = 2;
      bs.types.XBTAmountValue qty               = 3;
      bs.types.Side           side              = 4;
      string                  exchange_order_id = 5;
      bs.types.XBTPrice       price             = 6;
      string                  reject_reason     = 7;
   }

   message PriceUpdate
   {
      bs.types.XBTPrice ask = 1;
      bs.types.XBTPrice bid = 2;
   }

   oneof data
   {
      Empty          connected      = 1;
      Empty          disconnected   = 2;
      OrderRequest   order_request  = 3;
      OrderResponse  order_response = 4;
      PriceUpdate    price_update   = 5;
   }
}

message PriceAggregation
{
// Internal messages to self
   message ExternalConnectionStatusChanged
   {
      string   puller_name    = 1;
      string   product_name   = 2;
      bool     connected      = 3;
   }

   message ExternalConnectionPriceUpdated
   {
      string puller_name   = 1;
      string product_name  = 2;
      double bid           = 3;
      double ask           = 4;
   }

// broadcast message
   message AggregatedPriceUpdate
   {
      // aggregated price for XBT/EUR
      string   product_name   = 1;
      double   ask            = 2;
      double   bid            = 3;
   }

   message PriceAggregatorsStatusSnapshot
   {
      message PullerState
      {
         string      puller_name             = 1;
         string      product                 = 2;
         double      ask                     = 3;
         double      bid                     = 4;
         bool        connected               = 5;
         uint64      last_update_timestamp   = 6;
      }

      repeated PullerState puller_state         = 1;
      uint64               snapshot_timestamp   = 2;
   }

   oneof data
   {
      // internal messages
      ExternalConnectionStatusChanged  connection_status_changed  = 1;
      ExternalConnectionPriceUpdated   exchange_price_update      = 2;
      // broadcasted messages
      AggregatedPriceUpdate            aggregated_price           = 3;

      Empty                            get_puller_state_snapshot  = 4;
      PriceAggregatorsStatusSnapshot   puller_state_snapshot      = 5;
   }
}

message GenoaAdminMsg
{
   message TradingOpened
   {
      int64 session_id = 1;
      uint64 timestamp_open = 2;
      int32 product_type = 3;
      bs.types.XBTPrice open_price = 4;
      bs.types.XBTAmountValue open_interest = 5;
   }

   message TradingClosed
   {
      int64 session_id = 1;
      uint64 timestamp_close = 2;
      int32 product_type = 3;
      bs.types.XBTPrice cutoff_price = 4;
      bs.types.XBTAmountValue open_interest = 5;
      int64 novation_account_id = 6;
      repeated int64 participants = 7;
   }

   message UpdateOpenInterest
   {
      int32 product_type = 1;
      bs.types.XBTAmountValue open_interest = 2;
   }

   message OrderFailed
   {
      uint32 entity_id = 1;
      int32 product_type = 2;
      bs.types.Side side = 3;
      bs.types.XBTAmountValue amount = 4;
      bs.types.XBTPrice price = 5;
      string error_msg = 6;
   }

   message SessionFailed
   {
      int64 session_id = 1;
      int32 product_type = 2;
   }

   oneof data
   {
      TradingClosed trading_closed = 1;
      TradingOpened trading_opened = 2;
      Blocksettle.Communication.GenoaAdmin.Response.DefaultsInfo defaults_info = 3;
      UpdateOpenInterest update_open_interest = 4;
      OrderFailed order_failed = 5;
      SessionFailed session_failed = 6;
   }
}

message StatusExporterMessage
{
   message TradingStartedUpdate
   {
      string product_name = 1;
   }

   message TradingStoppedUpdate
   {
      string product_name = 1;
   }

   message InitialStatusQeuryTimeout
   {}

   message SessionStatusPollTimeout
   {}

   message SessionCloseGracePeriodTimeout
   {
      string product_name = 1;
   }

   message RequestProcessingTimeUpdate
   {
      // supported requests:
      //    create_reservations - Genoa reservations_service method
      string   request_name      = 1;
      uint64   execution_time_ms = 2;
   }

   oneof data
   {
      TradingStartedUpdate             trading_started               = 1;
      TradingStoppedUpdate             trading_stopped               = 2;
      InitialStatusQeuryTimeout        initial_status_query_timeout  = 3;
      SessionStatusPollTimeout         poll_session_status_timeout   = 4;
      SessionCloseGracePeriodTimeout   session_close_timeout         = 5;
      RequestProcessingTimeUpdate      request_processing_time       = 6;
   }
}


message UserControlMessage
{
   message RegisterAccountRequest
   {
      string answers = 1;
      string kyc = 2;
   }

   message RegisterAccountResponse
   {
      bool success = 1;
      string error_code = 2;
      string error_msg = 3;
      uint32 entity_id = 4;
   }

   message GetAllExternalAccountsRequest
   {
      uint32 entity_id = 1;
      Blocksettle.Communication.ApiServer.AccountType account_type = 2;
   }

   message GetAllExternalAccountsResponse
   {
      Blocksettle.Communication.ApiServer.Response.GetAllExternalAccounts result = 1;
   }

   message GetDepositInfoRequest
   {
      uint32 entity_id = 1;
   }

   message GetDepositInfoResponse
   {
      bool loaded = 1;
      string data = 2;
   }

   message WithdrawToExtAccountRequest
   {
      uint32                  entity_id      = 1;
      string                  account_name   = 2;
      bs.types.FXAmountValue  amount         = 3;
      string                  ccy            = 4;
      string                  access_token   = 5;
   }

   message WithdrawToExtAccountResponse
   {
      bool success = 1;
      string error_message  = 2;
   }

   message ListClientBanksRequest
   {
      string country_code = 1;
   }

   message ListClientBanksResponse
   {
      Blocksettle.Communication.ApiServer.Response.ListClientBanks result = 1;
   }

   message BankOnboardingLinkRequest
   {
      string bank_id = 1;
      string redirect_url = 2;
      bool sandbox = 3;
   }

   message BankOnboardingLinkResponse
   {
      string initiate = 1;
      string req_id = 2;
   }

   message ListRemoteAccountsRequest
   {
      string req_id = 1;
   }

   message ListRemoteAccountsResponse
   {
      Blocksettle.Communication.ApiServer.Response.ListRemoteAccounts result = 1;
   }

   message SaveAccountRequest
   {
      string account_ref = 1;
      uint32 entity_id = 2;
   }

   message SaveAccountResponse
   {
      Blocksettle.Communication.ApiServer.Response.SaveAccount result = 1;
   }

   message AddCardRequest
   {
      bool mobile = 1;
   }

   message AddCardResponse
   {
      Blocksettle.Communication.ApiServer.Response.RequestAddCard result = 1;
   }

   message ConfirmCardRequest
   {
      uint32 entity_id = 1;
      string payment_ref = 2;
   }

   message ConfirmCardResponse
   {
      Blocksettle.Communication.ApiServer.Response.ConfirmCard result = 1;
   }

   message ChargeCardRequest
   {
      uint32                  entity_id      = 1;
      int32                   account_id     = 2;
      string                  access_token   = 3;
      bs.types.FXAmountValue  amount         = 4;
   }

   message ChargeCardResponse
   {
      bool success = 1;
      string error_code = 2;
      string error_msg = 3;
   }

   message ValidateSessionRequest
   {
      string token         = 1;
      string api_endpoint  = 2;
   }

   message ValidateSessionResponse
   {
      int32  age = 2;
      uint32 valid_for = 3;
      uint32 entity_id = 4;
      string error_code = 5;
      string error_text = 6;
      int32  grant_code = 7;
      string grant = 8;
   }

   message RevokeTokenRequest
   {
      string token = 1;
   }

   message RevokeTokenResponse
   {
      bool success = 1;
      string error_code = 2;
      string error_text = 3;
   }

   oneof data
   {
      RegisterAccountRequest         register_account_req            = 1;
      RegisterAccountResponse        register_account_resp           = 2;
      GetAllExternalAccountsRequest  get_all_external_accounts_req   = 3;
      GetAllExternalAccountsResponse get_all_external_accounts_resp  = 4;
      GetDepositInfoRequest          get_deposit_info_req            = 5;
      GetDepositInfoResponse         get_deposit_info_resp           = 6;
      WithdrawToExtAccountRequest    withdraw_to_ext_account_req     = 7;
      WithdrawToExtAccountResponse   withdraw_to_ext_account_resp    = 8;
      ListClientBanksRequest         list_client_banks_request       = 9;
      ListClientBanksResponse        list_client_banks_response      = 10;
      BankOnboardingLinkRequest      bank_onboarding_link_request    = 11;
      BankOnboardingLinkResponse     bank_onboarding_link_response   = 12;
      ListRemoteAccountsRequest      list_remote_accounts_request    = 13;
      ListRemoteAccountsResponse     list_remote_accounts_response   = 14;
      SaveAccountRequest             save_account_request            = 15;
      SaveAccountResponse            save_account_response           = 16;
      AddCardRequest                 add_card_request                = 17;
      AddCardResponse                add_card_response               = 18;
      ConfirmCardRequest             confirm_card_request            = 19;
      ConfirmCardResponse            confirm_card_response           = 20;
      ChargeCardRequest              charge_card_request             = 21;
      ChargeCardResponse             charge_card_response            = 22;
      ValidateSessionRequest         validate_user_token_request     = 23;
      ValidateSessionResponse        validate_user_token_response    = 24;
      RevokeTokenRequest             revoke_token_request            = 25;
      RevokeTokenResponse            revoke_token_response           = 26;
   }
}

message AdminApiMessage
{
   message ClientConnectedEvent
   {
      bytes client_id   = 1;
   }

   message ClientDisconnectedEvent
   {
      bytes client_id   = 1;
   }

   message DataFromClientEvent
   {
      bytes client_id   = 1;
      bytes data        = 2;
   }

   oneof data
   {
      ClientConnectedEvent       client_connected     = 1;
      ClientDisconnectedEvent    client_disconnected  = 2;
      DataFromClientEvent        data_from_client     = 3;

      Empty                      update_ticker        = 4;
   }
}
